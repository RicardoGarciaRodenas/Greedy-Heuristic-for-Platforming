%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
    case 'Problem4bS' % P R O B L E M   4 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%    RUTAS: MATRIZ DE CONFLICTOS Y TIEMPOS DE VIAJES 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
Mueve=@(A) [A(:,3) A(:,4) A(:,1) A(:,2)]; 
n_rutas=13 ;  
t_pla=[5.233 ; 5.417 ; 5.700 ; 5.900 ; 6.050 ; 6.250 ; 6.633 ; 6.883 ; 7.133 ; 7.350 ; 7.500 ; 7.850 ; 7.967 ; 5.217 ; 6.500 ; 6.717 ; 7.000 ; 7.700 ; 4.950 ; 5.400 ; 5.600 ; 5.750 ; 5.800 ; 5.950 ; 6.000 ; 6.200 ; 6.300 ; 6.400 ; 6.517 ; 6.633 ; 6.750 ; 6.800 ; 6.900 ; 7.000 ; 7.100 ; 7.200 ; 7.333 ; 7.450 ; 7.550 ; 7.600 ; 7.700 ; 7.783 ; 7.900 ; 8.000 ; 5.983 ; 6.267 ; 6.517 ; 6.750 ; 6.983 ; 7.167 ; 7.367 ; 7.567 ; 7.750 ; 7.967 ; 6.433 ; 6.650 ; 6.933 ; 7.633 ; 7.950 ; 6.033 ; 6.333 ; 6.567 ; 6.833 ; 7.133 ; 7.367 ; 7.533 ; 7.633 ; 7.817 ; 5.583 ; 5.783 ; 5.983 ; 6.183 ; 6.283 ; 6.383 ; 6.483 ; 6.617 ; 6.733 ; 6.783 ; 6.883 ; 6.983 ; 7.083 ; 7.183 ; 7.317 ; 7.433 ; 7.583 ; 7.683 ; 7.767 ; 7.883 ; 7.983 ; ]; 
at=[5.321 ; 5.504 ; 5.788 ; 5.988 ; 6.138 ; 6.338 ; 6.721 ; 6.971 ; 7.221 ; 7.438 ; 7.588 ; 7.938 ; 8.054 ; 5.304 ; 6.588 ; 6.804 ; 7.088 ; 7.788 ; 5.038 ; 5.488 ; 5.688 ; 5.838 ; 5.888 ; 6.038 ; 6.088 ; 6.288 ; 6.388 ; 6.488 ; 6.604 ; 6.721 ; 6.838 ; 6.888 ; 6.988 ; 7.088 ; 7.188 ; 7.288 ; 7.421 ; 7.537 ; 7.638 ; 7.688 ; 7.788 ; 7.871 ; 7.988 ; 8.088 ; 6.071 ; 6.354 ; 6.604 ; 6.838 ; 7.071 ; 7.254 ; 7.454 ; 7.654 ; 7.838 ; 8.054 ; 6.521 ; 6.737 ; 7.021 ; 7.721 ; 8.037 ; 6.121 ; 6.421 ; 6.654 ; 6.921 ; 7.221 ; 7.454 ; 7.621 ; 7.721 ; 7.904 ; 5.671 ; 5.871 ; 6.071 ; 6.271 ; 6.371 ; 6.471 ; 6.571 ; 6.704 ; 6.821 ; 6.871 ; 6.971 ; 7.071 ; 7.171 ; 7.271 ; 7.404 ; 7.521 ; 7.671 ; 7.771 ; 7.854 ; 7.971 ; 8.071 ; ]; 
vt=[40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; 40.0 ; ]; 
n_t=length(t_pla);  % número de trenes 
Ntipotren=[1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 1.0 ; 5.0 ; 5.0 ; 5.0 ; 5.0 ; 5.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 13.0 ; 3.0 ; 3.0 ; 3.0 ; 3.0 ; 3.0 ; 3.0 ; 3.0 ; 3.0 ; 3.0 ; 3.0 ; 7.0 ; 7.0 ; 7.0 ; 7.0 ; 7.0 ; 19.0 ; 19.0 ; 19.0 ; 19.0 ; 19.0 ; 19.0 ; 19.0 ; 19.0 ; 19.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; 15.0 ; ]; 
tipotren={'C2+','','C2-','','C7+','','C7-','','C5+','','C5-','','C4+','','C4-','','C3+','','C3-'}; 
C{1,1}=[	    0.000 	    1.200 	    0.000 	    1.200  
			    1.000 	    1.450 	    1.000 	    1.450  
			    1.250 	    3.450 	    1.250 	    3.450  
			    3.250 	    3.700 	    3.250 	    3.700  
]; 
C{1,2}=[	    0.000 	    1.200 	    0.000 	    1.200  
			    1.000 	    1.450 	    1.000 	    1.450  
			    3.250 	    3.700 	    3.250 	    3.700  
]; 
C{1,3}=[	    1.000 	    1.450 	    1.000 	    1.450  
]; 
C{1,4}=[	    0.000 	    1.200 	    2.500 	    3.700  
			    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{1,5}=[	    0.000 	    1.200 	    2.500 	    3.700  
			    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{1,6}=[	    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{1,7}=[	    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{2,2}=[	    0.000 	    1.200 	    0.000 	    1.200  
			    1.000 	    1.450 	    1.000 	    1.450  
			    1.250 	    3.450 	    1.250 	    3.450  
			    3.250 	    3.700 	    3.250 	    3.700  
]; 
C{2,3}=[	    1.000 	    1.450 	    1.000 	    1.450  
			    1.250 	    3.450 	    1.250 	    3.450  
			    3.250 	    3.700 	    3.250 	    3.700  
]; 
C{2,4}=[	    0.000 	    1.200 	    2.500 	    3.700  
			    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{2,5}=[	    0.000 	    1.200 	    2.500 	    3.700  
			    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{2,6}=[	    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{2,7}=[	    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{3,3}=[	    0.000 	    1.200 	    0.000 	    1.200  
			    1.000 	    1.450 	    1.000 	    1.450  
			    1.250 	    3.450 	    1.250 	    3.450  
			    3.250 	    3.700 	    3.250 	    3.700  
]; 
C{3,4}=[	    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{3,5}=[	    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{3,6}=[	    0.000 	    1.200 	    2.500 	    3.700  
			    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{3,7}=[	    0.000 	    1.200 	    2.500 	    3.700  
			    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{4,4}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{4,5}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{4,6}=[	    2.250 	    2.700 	    2.250 	    2.700  
]; 
C{4,7}=[	    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{5,5}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{5,6}=[	    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{5,7}=[	    2.250 	    2.700 	    2.250 	    2.700  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{6,6}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{6,7}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{7,7}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{8,8}=[	    0.000 	    1.200 	    0.000 	    1.200  
			    1.000 	    1.450 	    1.000 	    1.450  
			    1.250 	    3.450 	    1.250 	    3.450  
			    3.250 	    3.700 	    3.250 	    3.700  
]; 
C{8,9}=[	    0.000 	    1.200 	    0.000 	    1.200  
			    1.000 	    1.450 	    1.000 	    1.450  
			    3.250 	    3.700 	    3.250 	    3.700  
]; 
C{9,9}=[	    0.000 	    1.200 	    0.000 	    1.200  
			    1.000 	    1.450 	    1.000 	    1.450  
			    1.250 	    3.450 	    1.250 	    3.450  
			    3.250 	    3.700 	    3.250 	    3.700  
]; 
C{9,10}=[	    1.000 	    1.450 	    2.250 	    2.700  
			    1.250 	    3.450 	    0.250 	    2.450  
			    3.250 	    3.700 	    0.000 	    0.450  
]; 
C{9,11}=[	    1.000 	    1.450 	    2.250 	    2.700  
			    3.250 	    3.700 	    0.000 	    0.450  
]; 
C{9,12}=[	    1.000 	    1.450 	    2.250 	    2.700  
]; 
C{9,13}=[	    1.000 	    1.450 	    2.250 	    2.700  
			    1.250 	    3.450 	    0.250 	    2.450  
			    3.250 	    3.700 	    0.000 	    0.450  
]; 
C{10,10}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{10,11}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{10,12}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
]; 
C{10,13}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{11,11}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{11,12}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{11,13}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{12,12}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{12,13}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{13,13}=[	    2.500 	    3.700 	    2.500 	    3.700  
			    2.250 	    2.700 	    2.250 	    2.700  
			    0.250 	    2.450 	    0.250 	    2.450  
			    0.000 	    0.450 	    0.000 	    0.450  
]; 
C{1,1}=Mueve(C{1,1}); 
C{2,1}=Mueve(C{1,2}); 
C{3,1}=Mueve(C{1,3}); 
C{4,1}=Mueve(C{1,4}); 
C{5,1}=Mueve(C{1,5}); 
C{6,1}=Mueve(C{1,6}); 
C{7,1}=Mueve(C{1,7}); 
C{2,2}=Mueve(C{2,2}); 
C{3,2}=Mueve(C{2,3}); 
C{4,2}=Mueve(C{2,4}); 
C{5,2}=Mueve(C{2,5}); 
C{6,2}=Mueve(C{2,6}); 
C{7,2}=Mueve(C{2,7}); 
C{3,3}=Mueve(C{3,3}); 
C{4,3}=Mueve(C{3,4}); 
C{5,3}=Mueve(C{3,5}); 
C{6,3}=Mueve(C{3,6}); 
C{7,3}=Mueve(C{3,7}); 
C{4,4}=Mueve(C{4,4}); 
C{5,4}=Mueve(C{4,5}); 
C{6,4}=Mueve(C{4,6}); 
C{7,4}=Mueve(C{4,7}); 
C{5,5}=Mueve(C{5,5}); 
C{6,5}=Mueve(C{5,6}); 
C{7,5}=Mueve(C{5,7}); 
C{6,6}=Mueve(C{6,6}); 
C{7,6}=Mueve(C{6,7}); 
C{7,7}=Mueve(C{7,7}); 
C{8,8}=Mueve(C{8,8}); 
C{9,8}=Mueve(C{8,9}); 
C{9,9}=Mueve(C{9,9}); 
C{10,9}=Mueve(C{9,10}); 
C{11,9}=Mueve(C{9,11}); 
C{12,9}=Mueve(C{9,12}); 
C{13,9}=Mueve(C{9,13}); 
C{10,10}=Mueve(C{10,10}); 
C{11,10}=Mueve(C{10,11}); 
C{12,10}=Mueve(C{10,12}); 
C{13,10}=Mueve(C{10,13}); 
C{11,11}=Mueve(C{11,11}); 
C{12,11}=Mueve(C{11,12}); 
C{13,11}=Mueve(C{11,13}); 
C{12,12}=Mueve(C{12,12}); 
C{13,12}=Mueve(C{12,13}); 
C{13,13}=Mueve(C{13,13}); 
Marcha=zeros(n_t,n_rutas); 
Marcha(1:44,[1,2,3,8,9])=+1; 
Marcha(45:89,[4,5,6,7,10,11,12,13])=-1; 
TVr=[3.500 ;3.500 ;3.500 ;3.500 ;3.500 ;3.500 ;3.500 ;3.500 ;3.500 ;3.500 ;3.500 ;3.500 ;3.500 ]; 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%  asignacion rutas a trenes 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
R{1}=[3]; 
R{2}=[3]; 
R{3}=[3]; 
R{4}=[3]; 
R{5}=[3]; 
R{6}=[3]; 
R{7}=[3]; 
R{8}=[3]; 
R{9}=[3]; 
R{10}=[3]; 
R{11}=[3]; 
R{12}=[3]; 
R{13}=[3]; 
R{14}=[1,2]; 
R{15}=[1,2]; 
R{16}=[1,2]; 
R{17}=[1,2]; 
R{18}=[1,2]; 
R{19}=[8,9]; 
R{20}=[8,9]; 
R{21}=[8,9]; 
R{22}=[8,9]; 
R{23}=[8,9]; 
R{24}=[8,9]; 
R{25}=[8,9]; 
R{26}=[8,9]; 
R{27}=[8,9]; 
R{28}=[8,9]; 
R{29}=[8,9]; 
R{30}=[8,9]; 
R{31}=[8,9]; 
R{32}=[8,9]; 
R{33}=[8,9]; 
R{34}=[8,9]; 
R{35}=[8,9]; 
R{36}=[8,9]; 
R{37}=[8,9]; 
R{38}=[8,9]; 
R{39}=[8,9]; 
R{40}=[8,9]; 
R{41}=[8,9]; 
R{42}=[8,9]; 
R{43}=[8,9]; 
R{44}=[8,9]; 
R{45}=[6,7]; 
R{46}=[6,7]; 
R{47}=[6,7]; 
R{48}=[6,7]; 
R{49}=[6,7]; 
R{50}=[6,7]; 
R{51}=[6,7]; 
R{52}=[6,7]; 
R{53}=[6,7]; 
R{54}=[6,7]; 
R{55}=[4,5]; 
R{56}=[4,5]; 
R{57}=[4,5]; 
R{58}=[4,5]; 
R{59}=[4,5]; 
R{60}=[10,11]; 
R{61}=[10,11]; 
R{62}=[10,11]; 
R{63}=[10,11]; 
R{64}=[10,11]; 
R{65}=[10,11]; 
R{66}=[10,11]; 
R{67}=[10,11]; 
R{68}=[10,11]; 
R{69}=[12,13]; 
R{70}=[12,13]; 
R{71}=[12,13]; 
R{72}=[12,13]; 
R{73}=[12,13]; 
R{74}=[12,13]; 
R{75}=[12,13]; 
R{76}=[12,13]; 
R{77}=[12,13]; 
R{78}=[12,13]; 
R{79}=[12,13]; 
R{80}=[12,13]; 
R{81}=[12,13]; 
R{82}=[12,13]; 
R{83}=[12,13]; 
R{84}=[12,13]; 
R{85}=[12,13]; 
R{86}=[12,13]; 
R{87}=[12,13]; 
R{88}=[12,13]; 
R{89}=[12,13]; 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%% ordenacion procesamiento de trenes            %%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
[t_pla,I]=sort(t_pla); % ordenacion de procesamiento de trenes 
at=at(I); 
vt=vt.^(-1); 
vt=vt(I); 
Ntipotren=Ntipotren(I); 
Raux=R; 
Marcha=Marcha(I,:); 
for i=1:n_t 
   R{i}=Raux{I(i)}; 
end 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 %%%                 tiempo de viaje trenes 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 for t1=1:n_t 
     for i_r=1:length(R{t1}) 
         D_t(t1,i_r)=TVr(R{t1}(i_r))*vt(t1)-at(t1); 
     end 
 end 
 n_s=0; % numero máximo de conflicto entre un par de trenes 
for t1=1:n_t-1 
    for t2=t1+1:n_t 
        for i_r1=1:length(R{t1}) 
            r1=R{t1}(i_r1); 
            for i_r2=1:length(R{t2}) 
                r2=R{t2}(i_r2); 
                if length(C{r1,r2})>0 
                C_t{i_r1,i_r2,t1,t2}=[C{r1,r2}(:,1:2)*vt(t1) C{r1,r2}(:,3:4)*vt(t2)]; 
                C_t{i_r2,i_r1,t2,t1}=[C{r2,r1}(:,1:2)*vt(t2) C{r2,r1}(:,3:4)*vt(t1)]; 
                n_s=max(n_s,size(C_t{i_r1,i_r2,t1,t2},1)); 
                end 
            end 
        end 
    end 
end 
